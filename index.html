<!doctype html>

<title>CodeMirror</title>
<meta charset="utf-8"/>

<link rel=stylesheet href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.38.0/codemirror.min.css">
<link rel=stylesheet href="addon/hint/show-hint.css">
<link rel=stylesheet href="doc/docs.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.38.0/codemirror.min.js"></script>
<script src="mode/javascript/javascript.js"></script>
<script src="mode/velocity/velocity.js"></script>
<script src="addon/hint/show-hint.js"></script> 
<script src="addon/hint/javascript-hint.js"></script>

<style>
body {
  background-color: #eee;
}
</style>

<article>

<section id="demo">
  <h2> Text Editor Demo </h2>
  <form style="position: relative; margin-top: .5em;">
    <textarea id="code" name="code">
#define( $hello ) Hello $who #end #set( $who = "World!") $hello ## displays Hello World!

#foreach( $customer in $customerList )

    $foreach.count $customer.Name

    #if( $foo == ${bar})
        it's true!
        #break
    #{else}
        it's not!
        #stop
    #end

    #if ($foreach.parent.hasNext)
        $velocityCount
    #end
#end

$someObject.getValues("this is a string split
        across lines")

$someObject("This plus $something in the middle").method(7567).property

#set($something = "Parseable string with '$quotes'!")

#macro( tablerows $color $somelist )
    #foreach( $something in $somelist )
        <tr><td bgcolor=$color>$something</td></tr>
        <tr><td bgcolor=$color>$bodyContent</td></tr>
    #end
#end
    </textarea>
  
  <script>
    var comp = [
      ["here", "hither"],
      ["asynchronous", "nonsynchronous"],
      ["completion", "achievement", "conclusion", "culmination", "expirations"],
      ["hinting", "advive", "broach", "imply"],
      ["function","action"],
      ["provide", "add", "bring", "give"],
      ["synonyms", "equivalents"],
      ["words", "token"],
      ["each", "every"],
    ]

    function synonyms(cm, option) {
      return new Promise(function(accept) {
        setTimeout(function() {
          var cursor = cm.getCursor(), line = cm.getLine(cursor.line)
          var start = cursor.ch, end = cursor.ch
          while (start && /\w/.test(line.charAt(start - 1))) --start
          while (end < line.length && /\w/.test(line.charAt(end))) ++end
          var word = line.slice(start, end).toLowerCase()
          for (var i = 0; i < comp.length; i++) if (comp[i].indexOf(word) != -1)
            return accept({list: comp[i],
                           from: CodeMirror.Pos(cursor.line, start),
                           to: CodeMirror.Pos(cursor.line, end)})
          return accept(null)
        }, 100)
      })
    }

    var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
      lineNumbers: true,
      extraKeys: {"Ctrl-Space": "autocomplete"},
      mode: {name: "velocity", globalVars: true},
      hintOptions : {hint: synonyms}
    });
  </script>

</section>

</article>
